<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1eoxw1v" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.12.0" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.15.0">
  <bpmn:process id="amlCsmKycPaymentRequest" name="17. Сохранение результатов Онлайн от поисковой машины по платежам" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_0dvx4sc</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:endEvent id="Event_009dr5b">
      <bpmn:incoming>Flow_1qkyy98</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_1jae6rb" name="Логирование процесса" camunda:delegateExpression="${loggerDelegate}">
      <bpmn:incoming>Flow_0dvx4sc</bpmn:incoming>
      <bpmn:outgoing>Flow_0tmz7xl</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0dvx4sc" sourceRef="StartEvent_1" targetRef="Activity_1jae6rb" />
    <bpmn:serviceTask id="Activity_1qwn6qf" name="Открыть сессию"
                      camunda:delegateExpression="${openSessionRnkbDelegate}">
        <bpmn:incoming>Flow_0tmz7xl</bpmn:incoming>
        <bpmn:outgoing>Flow_1fmjt5z</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:subProcess id="Activity_038bidn">
      <bpmn:incoming>Flow_1fmjt5z</bpmn:incoming>
      <bpmn:outgoing>Flow_16i4xfs</bpmn:outgoing>
      <bpmn:startEvent id="Event_1i5ua25">
        <bpmn:outgoing>Flow_1jftf2k</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:subProcess id="Activity_0r6pu6m" name="Save PAYMENTPARTICIPANTLIST">
        <bpmn:incoming>Flow_0iv08qe</bpmn:incoming>
        <bpmn:outgoing>Flow_14oy0al</bpmn:outgoing>
        <bpmn:multiInstanceLoopCharacteristics isSequential="true" camunda:collection="${participantElements.elements()}" camunda:elementVariable="participantElement" />
        <bpmn:startEvent id="Event_0zr8io9">
          <bpmn:outgoing>Flow_0ta22l9</bpmn:outgoing>
        </bpmn:startEvent>
        <bpmn:sequenceFlow id="Flow_0ta22l9" sourceRef="Event_0zr8io9" targetRef="Activity_0nb4w2c" />
        <bpmn:serviceTask id="Activity_0b3n9ai" name="Select client" camunda:delegateExpression="${selectOneDelegate}">
          <bpmn:extensionElements>
            <camunda:inputOutput>
              <camunda:inputParameter name="outputVarName">client</camunda:inputParameter>
              <camunda:inputParameter name="parameters">
                <camunda:map>
                  <camunda:entry key="clientId">${clientId}</camunda:entry>
                </camunda:map>
              </camunda:inputParameter>
              <camunda:inputParameter name="selectQuery">SELECT c FROM Client c WHERE c.exClientId = :clientId</camunda:inputParameter>
            </camunda:inputOutput>
          </bpmn:extensionElements>
          <bpmn:incoming>Flow_0bpnrqx</bpmn:incoming>
          <bpmn:outgoing>Flow_1wz3krn</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:scriptTask id="Activity_0tkm8x5" name="Fill items" scriptFormat="groovy">
          <bpmn:incoming>Flow_1wz3krn</bpmn:incoming>
          <bpmn:incoming>Flow_0mdt0l2</bpmn:incoming>
          <bpmn:outgoing>Flow_15ozxgg</bpmn:outgoing>
          <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.BaseDictionary

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

def participantElement = execution.getVariable("participantElement")
def participantType = participantElement.prop("PartType").numberValue().toString()

def results = participantElement.prop("Results")
def kycList = participantElement.prop("KYCList")?.elements()

def partTypeBd = getBd(169, participantType)

def kycItems = JSON("[]")

kycList?.each{kycItem -&gt;
    def checkStatus = kycItem.prop("CheckStatus").stringValue()
    if(checkStatus == "1" || checkStatus == "2" || checkStatus == "3") {
        kycItems.append(kycItem)
    }
}

execution.setVariable("resultItems", results)
execution.setVariable("kycItems", kycItems)
execution.setVariable("partTypeBd", partTypeBd)</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:sequenceFlow id="Flow_1wz3krn" sourceRef="Activity_0b3n9ai" targetRef="Activity_0tkm8x5" />
        <bpmn:subProcess id="Activity_1gl8w9m" name="Parse results">
          <bpmn:incoming>Flow_13273lk</bpmn:incoming>
          <bpmn:outgoing>Flow_1hol4z5</bpmn:outgoing>
          <bpmn:multiInstanceLoopCharacteristics isSequential="true" camunda:collection="${resultItems.elements()}" camunda:elementVariable="resultItem" />
          <bpmn:startEvent id="Event_0nv9ff9">
            <bpmn:outgoing>Flow_18p96ei</bpmn:outgoing>
          </bpmn:startEvent>
          <bpmn:scriptTask id="Activity_0m9twxx" name="Fill participant" scriptFormat="groovy">
            <bpmn:incoming>Flow_18p96ei</bpmn:incoming>
            <bpmn:outgoing>Flow_0xdcwid</bpmn:outgoing>
            <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.PaymentParticipantList
import com.prime.db.rnkb.model.BaseDictionary
import org.camunda.spin.json.SpinJsonNode

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

String getMarkers(SpinJsonNode node, List&lt;String&gt; markers) {
    def result = []
    markers.each{m -&gt;
        if(m.startsWith("M")) {
            if(node.prop(m).isBoolean() &amp;&amp; node.prop(m).boolValue() == true)
                result.add(m)
        } else {
            if(node.prop(m)?.numberValue() != 0)
                result.add(m)
        }
    }

    return result.join(";")
}

def markers = ["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16",
"M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","D27","D28","D29","D0","M28","M29","M30",
"M31","M32","M33","M34","M35","M36"]

def validCheckStatus = ["1","2","3"]

def partTypeBd = execution.getVariable("partTypeBd")
def resultItem = execution.getVariable("resultItem")
def client = execution.getVariable("client")
def payment = execution.getVariable("payment")

def recordItem = resultItem.prop("record")

def exId = recordItem.prop("exId").stringValue()
def isActive = recordItem.prop("isActive").boolValue()
def entityType = recordItem.prop("entityType").stringValue()
def num = recordItem.prop("num").stringValue()
def d0 = resultItem.prop("D0").numberValue()?.intValue()

def kycItem = resultItem.prop("KYCList")
def checkStatus = null
def typeList = kycItem.prop("Id")?.stringValue()
def levelBlocking = Integer.parseInt(kycItem.prop("LevelBlocking")?.stringValue())

if(!kycItem.prop("CheckStatus").isNull()) {
    def status = kycItem.prop("CheckStatus").stringValue()
    if(validCheckStatus.any{code -&gt; code == status}) {
        checkStatus = Integer.parseInt(status)
    }
}

def partItem = new PaymentParticipantList()
partItem.otherPersonType = partTypeBd
partItem.clientId = client
partItem.exId = exId
partItem.num = num
partItem.markers = getMarkers(resultItem, markers)
partItem.nameMatch = d0
partItem.isActive = isActive
partItem.entityType = entityType
partItem.paymentId = payment
partItem.levelBlocking = levelBlocking
partItem.checkStatus = checkStatus
partItem.typeList = getBd(214, typeList)

execution.setVariable("partItem", partItem)</bpmn:script>
          </bpmn:scriptTask>
          <bpmn:scriptTask id="Activity_1y9vtta" name="Fill name" scriptFormat="groovy">
            <bpmn:incoming>Flow_0s3o05k</bpmn:incoming>
            <bpmn:outgoing>Flow_1kzf160</bpmn:outgoing>
            <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.PaymentNameList;
import com.prime.db.rnkb.model.BaseDictionary

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

def resultItem = execution.getVariable("resultItem")
def partItem = execution.getVariable("partItem")


def names = resultItem.prop("record")?.prop("nameList")?.elements()

def bestMatch = resultItem.prop("bestMatch")?.prop("name")?.stringValue()
def bestMatchType = resultItem.prop("bestMatch")?.prop("nameType")?.stringValue()

def saveObjects = []

names?.each{name -&gt; 
    def nameType = name.prop("nameType").stringValue()
    
    def nameList = new PaymentNameList()
    nameList.paymentParticipantListId = partItem
    nameList.nameType = getBd(280, nameType)
    nameList.name = name.prop("name").stringValue();
    if(name.hasProp("firstName")) nameList.firstName = name.prop("firstName").stringValue();
    if(name.hasProp("lastName")) nameList.lastName = name.prop("lastName").stringValue();
    if(name.hasProp("middleName")) nameList.middleName = name.prop("middleName").stringValue();
    nameList.bestMatch = (nameType == bestMatchType);

    saveObjects.add(nameList)
}

execution.setVariable("saveObjects", saveObjects)</bpmn:script>
          </bpmn:scriptTask>
          <bpmn:scriptTask id="Activity_1wycmbs" name="Fill address" scriptFormat="groovy">
            <bpmn:incoming>Flow_1kzf160</bpmn:incoming>
            <bpmn:outgoing>Flow_0rkt63w</bpmn:outgoing>
            <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.PaymentAddressList;

import com.prime.db.rnkb.model.BaseDictionary

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

def resultItem = execution.getVariable("resultItem")
def partItem = execution.getVariable("partItem")
def saveObjects = execution.getVariable("saveObjects")

def addresses = resultItem?.prop("record")?.prop("addressList")?.elements()

addresses?.each{address -&gt; 
    def addressType = address.prop("addressType").stringValue()
    
    def addressList = new PaymentAddressList()

    addressList.paymentParticipantListId = partItem
    addressList.addressType = getBd(281, addressType)
    addressList.addressLine = address.prop("addressLine").stringValue();

    saveObjects.add(addressList)
}

execution.setVariable("saveObjects", saveObjects)</bpmn:script>
          </bpmn:scriptTask>
          <bpmn:scriptTask id="Activity_0o0n8xl" name="Fill date" scriptFormat="groovy">
            <bpmn:incoming>Flow_0rkt63w</bpmn:incoming>
            <bpmn:outgoing>Flow_120dadj</bpmn:outgoing>
            <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.PaymentDateDetails;

import com.prime.db.rnkb.model.BaseDictionary

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

def resultItem = execution.getVariable("resultItem")
def partItem = execution.getVariable("partItem")
def saveObjects = execution.getVariable("saveObjects")

def dates = resultItem?.prop("record")?.prop("dateDetails")?.elements()

dates?.each{date -&gt; 
    def dateDetails = new PaymentDateDetails()

    dateDetails.paymentParticipantListId = partItem
    dateDetails.dateTypeId = getBd(282, date.prop("dateTypeId").stringValue())
    dateDetails.dateValue = date.prop("dateValue").stringValue();
    dateDetails.day = date.prop("day").numberValue().toString();
    dateDetails.month = date.prop("month").numberValue().toString();
    dateDetails.year = date.prop("year").numberValue().toString();

    saveObjects.add(dateDetails)
}

execution.setVariable("saveObjects", saveObjects)</bpmn:script>
          </bpmn:scriptTask>
          <bpmn:scriptTask id="Activity_07x6zp6" name="Fill identity" scriptFormat="groovy">
            <bpmn:incoming>Flow_120dadj</bpmn:incoming>
            <bpmn:outgoing>Flow_0hx378b</bpmn:outgoing>
            <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.PaymentIdentityAdrList;

import com.prime.db.rnkb.model.BaseDictionary

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

def resultItem = execution.getVariable("resultItem")
def partItem = execution.getVariable("partItem")
def saveObjects = execution.getVariable("saveObjects")

def ids = resultItem?.prop("record")?.prop("identityAtrList")?.elements()

ids?.each{id -&gt; 
    def idType = id.prop("idType").stringValue()
    
    def identityList = new PaymentIdentityAdrList()

    identityList.paymentParticipantListId = partItem
    identityList.idType = getBd(283, idType)
    if(id.hasProp("idValue")) identityList.idValue = id.prop("idValue").stringValue();
    if(id.hasProp("idNumber")) identityList.idNumber = id.prop("idNumber").stringValue();

    saveObjects.add(identityList)
}

execution.setVariable("saveObjects", saveObjects)
</bpmn:script>
          </bpmn:scriptTask>
          <bpmn:scriptTask id="Activity_0u8r0f3" name="Fill versions" scriptFormat="groovy">
            <bpmn:incoming>Flow_0hx378b</bpmn:incoming>
            <bpmn:outgoing>Flow_0amh954</bpmn:outgoing>
            <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.PaymentVersionsList;
import java.time.LocalDateTime
import java.time.format.DateTimeFormatter

import com.prime.db.rnkb.model.BaseDictionary

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

def resultItem = execution.getVariable("resultItem")
def partItem = execution.getVariable("partItem")
def saveObjects = execution.getVariable("saveObjects")

def versions = resultItem?.prop("record")?.prop("versionsList")?.elements()
def signOfTerrorist = 0
if(resultItem.prop("record").hasProp("signOfTerrorist")) {
    signOfTerrorist = resultItem.prop("record").prop("signOfTerrorist").numberValue().intValue()
}

DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd'T'HH:mm:ss.SSS");

versions?.each{version -&gt; 
    def versionList = new PaymentVersionsList()

    versionList.paymentParticipantListId = partItem
    versionList.listIdentifier = version.prop("listIdentifier").stringValue()
    versionList.listVersion = version.prop("listVersion").stringValue()
    versionList.versionDate = LocalDateTime.parse(version.prop("versionDate").stringValue(), formatter)
    versionList.loadDate = LocalDateTime.parse(version.prop("loadDate").stringValue(), formatter)
    versionList.updateDate = LocalDateTime.parse(version.prop("updateDate").stringValue(), formatter)
    versionList.isLastVersion = version.prop("isLastVersion").boolValue()
    versionList.signOfTerrorist = signOfTerrorist

    saveObjects.add(versionList)
}

execution.setVariable("saveObjects", saveObjects)</bpmn:script>
          </bpmn:scriptTask>
          <bpmn:serviceTask id="Activity_saveResultPaymentDetails" name="Сохранить зависимости PAYMENTPARTICIPANTLIST" camunda:delegateExpression="${saveObjectListDelegate}">
            <bpmn:extensionElements>
              <camunda:inputOutput>
                <camunda:inputParameter name="saveObjectList">${saveObjects}</camunda:inputParameter>
              </camunda:inputOutput>
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_0amh954</bpmn:incoming>
          </bpmn:serviceTask>
          <bpmn:serviceTask id="Activity_saveResultPayment" name="Сохранить PAYMENTPARTICIPANTLIST" camunda:delegateExpression="${saveObjectDelegate}">
            <bpmn:extensionElements>
              <camunda:inputOutput>
                <camunda:inputParameter name="outputVarName">partItem</camunda:inputParameter>
                <camunda:inputParameter name="saveObject">${partItem}</camunda:inputParameter>
              </camunda:inputOutput>
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_0xdcwid</bpmn:incoming>
            <bpmn:outgoing>Flow_0s3o05k</bpmn:outgoing>
          </bpmn:serviceTask>
          <bpmn:sequenceFlow id="Flow_0xdcwid" sourceRef="Activity_0m9twxx" targetRef="Activity_saveResultPayment" />
          <bpmn:sequenceFlow id="Flow_18p96ei" sourceRef="Event_0nv9ff9" targetRef="Activity_0m9twxx" />
          <bpmn:sequenceFlow id="Flow_0s3o05k" sourceRef="Activity_saveResultPayment" targetRef="Activity_1y9vtta" />
          <bpmn:sequenceFlow id="Flow_1kzf160" sourceRef="Activity_1y9vtta" targetRef="Activity_1wycmbs" />
          <bpmn:sequenceFlow id="Flow_0rkt63w" sourceRef="Activity_1wycmbs" targetRef="Activity_0o0n8xl" />
          <bpmn:sequenceFlow id="Flow_120dadj" sourceRef="Activity_0o0n8xl" targetRef="Activity_07x6zp6" />
          <bpmn:sequenceFlow id="Flow_0hx378b" sourceRef="Activity_07x6zp6" targetRef="Activity_0u8r0f3" />
          <bpmn:sequenceFlow id="Flow_0amh954" sourceRef="Activity_0u8r0f3" targetRef="Activity_saveResultPaymentDetails" />
        </bpmn:subProcess>
        <bpmn:subProcess id="Activity_0ssloc2" name="Parse kyc">
          <bpmn:incoming>Flow_15ozxgg</bpmn:incoming>
          <bpmn:outgoing>Flow_13273lk</bpmn:outgoing>
          <bpmn:multiInstanceLoopCharacteristics isSequential="true" camunda:collection="${kycItems.elements()}" camunda:elementVariable="kycItem" />
          <bpmn:startEvent id="Event_0oscivf">
            <bpmn:outgoing>Flow_1bqv0dq</bpmn:outgoing>
          </bpmn:startEvent>
          <bpmn:scriptTask id="Activity_1a2ocux" name="Fill items" scriptFormat="groovy">
            <bpmn:incoming>Flow_1bqv0dq</bpmn:incoming>
            <bpmn:outgoing>Flow_0g5gua9</bpmn:outgoing>
            <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*
import com.prime.db.rnkb.model.PaymentParticipantList
import com.prime.db.rnkb.model.BaseDictionary

BaseDictionary getBd(Integer type, String code) {
   baseDictRepo.getByBaseDictionaryTypeCodeAndCode(type, code);
}

def kycItem = execution.getVariable("kycItem")
def client = execution.getVariable("client")
def partTypeBd = execution.getVariable("partTypeBd")
def payment = execution.getVariable("payment")


def checkStatus = null 
def validCheckStatus = ["1","2","3"]

def typeList = kycItem.prop("Id").stringValue()
def levelBlocking = Integer.parseInt(kycItem.prop("LevelBlocking").stringValue())

if(!kycItem.prop("CheckStatus").isNull()) {
    checkStatus = kycItem.prop("CheckStatus").stringValue()
}

def partItem = null 
if(validCheckStatus.any{code -&gt; code == checkStatus}) {
    partItem = new PaymentParticipantList()
    partItem.otherPersonType = partTypeBd
    partItem.clientId = client
    partItem.typeList = getBd(214, typeList)
    partItem.checkStatus = Integer.parseInt(checkStatus)
    partItem.levelBlocking = levelBlocking
    partItem.paymentId = payment
}

execution.setVariable("partItem", partItem)</bpmn:script>
          </bpmn:scriptTask>
          <bpmn:sequenceFlow id="Flow_1bqv0dq" sourceRef="Event_0oscivf" targetRef="Activity_1a2ocux" />
          <bpmn:serviceTask id="Activity_saveKyc" name="Сохранить PAYMENTPARTICIPANTLIST" camunda:delegateExpression="${saveObjectDelegate}">
            <bpmn:extensionElements>
              <camunda:inputOutput>
                <camunda:inputParameter name="saveObject">${partItem}</camunda:inputParameter>
              </camunda:inputOutput>
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_0uwbuwb</bpmn:incoming>
            <bpmn:outgoing>Flow_0p7b6p4</bpmn:outgoing>
          </bpmn:serviceTask>
          <bpmn:sequenceFlow id="Flow_0g5gua9" sourceRef="Activity_1a2ocux" targetRef="Gateway_0m59lfj" />
          <bpmn:endEvent id="Event_1xilmdc">
            <bpmn:incoming>Flow_0p7b6p4</bpmn:incoming>
          </bpmn:endEvent>
          <bpmn:sequenceFlow id="Flow_0p7b6p4" sourceRef="Activity_saveKyc" targetRef="Event_1xilmdc" />
          <bpmn:exclusiveGateway id="Gateway_0m59lfj" default="Flow_0xvvzc9">
            <bpmn:incoming>Flow_0g5gua9</bpmn:incoming>
            <bpmn:outgoing>Flow_0uwbuwb</bpmn:outgoing>
            <bpmn:outgoing>Flow_0xvvzc9</bpmn:outgoing>
          </bpmn:exclusiveGateway>
          <bpmn:sequenceFlow id="Flow_0uwbuwb" sourceRef="Gateway_0m59lfj" targetRef="Activity_saveKyc">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${partItem != null}</bpmn:conditionExpression>
          </bpmn:sequenceFlow>
          <bpmn:endEvent id="Event_10zoaaq">
            <bpmn:incoming>Flow_0xvvzc9</bpmn:incoming>
          </bpmn:endEvent>
          <bpmn:sequenceFlow id="Flow_0xvvzc9" sourceRef="Gateway_0m59lfj" targetRef="Event_10zoaaq" />
        </bpmn:subProcess>
        <bpmn:sequenceFlow id="Flow_15ozxgg" sourceRef="Activity_0tkm8x5" targetRef="Activity_0ssloc2" />
        <bpmn:sequenceFlow id="Flow_13273lk" sourceRef="Activity_0ssloc2" targetRef="Activity_1gl8w9m" />
        <bpmn:endEvent id="Event_18yqgty">
          <bpmn:incoming>Flow_1hol4z5</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:sequenceFlow id="Flow_1hol4z5" sourceRef="Activity_1gl8w9m" targetRef="Event_18yqgty" />
        <bpmn:scriptTask id="Activity_0nb4w2c" name="clientId" scriptFormat="groovy">
          <bpmn:incoming>Flow_0ta22l9</bpmn:incoming>
          <bpmn:outgoing>Flow_0282xbk</bpmn:outgoing>
          <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*

def propClientId = participantElement.prop("ClientId")
if(!propClientId.isNull()) {
    execution.setVariable("clientId", propClientId.stringValue())
} else {
    execution.setVariable("clientId", null)
}
</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:exclusiveGateway id="Gateway_06l322v" default="Flow_0mdt0l2">
          <bpmn:incoming>Flow_0282xbk</bpmn:incoming>
          <bpmn:outgoing>Flow_0bpnrqx</bpmn:outgoing>
          <bpmn:outgoing>Flow_0mdt0l2</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_0282xbk" sourceRef="Activity_0nb4w2c" targetRef="Gateway_06l322v" />
        <bpmn:sequenceFlow id="Flow_0bpnrqx" sourceRef="Gateway_06l322v" targetRef="Activity_0b3n9ai">
          <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${clientId != null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="Flow_0mdt0l2" sourceRef="Gateway_06l322v" targetRef="Activity_0tkm8x5" />
      </bpmn:subProcess>
      <bpmn:scriptTask id="Activity_payload" name="Payload" scriptFormat="groovy">
        <bpmn:incoming>Flow_1jftf2k</bpmn:incoming>
        <bpmn:outgoing>Flow_1umk5kd</bpmn:outgoing>
        <bpmn:script>import static org.camunda.spin.Spin.*
import static org.camunda.spin.DataFormats.*

def jsonStr = execution.getVariable("payload")
def jsonData = JSON(jsonStr)

def payloadObject = jsonData.prop("payload").prop("amlPaymentRejection")

def paymentEvents = payloadObject.prop("RequestData").prop("PaymentEvents").elements()
if(paymentEvents.size() &gt; 0) {
    def paymentEvent = paymentEvents.get(0);
    def participantElements = paymentEvent.prop("Participants")
    def sourceId = paymentEvent.prop("SourceId").stringValue()

    execution.setVariable("participantElements", participantElements)
    execution.setVariable("sourceId", sourceId)
} else {
    throw new RuntimeException("Invalid PaymentEvents");
}</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:sequenceFlow id="Flow_1jftf2k" sourceRef="Event_1i5ua25" targetRef="Activity_payload" />
      <bpmn:sequenceFlow id="Flow_1umk5kd" sourceRef="Activity_payload" targetRef="Activity_1rg2fzk" />
      <bpmn:endEvent id="Event_0knzkdy">
        <bpmn:incoming>Flow_0ckeiru</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_14oy0al" sourceRef="Activity_0r6pu6m" targetRef="Activity_0niwx3m" />
      <bpmn:serviceTask id="Activity_1rg2fzk" name="Select payment" camunda:delegateExpression="${selectOneDelegate}">
        <bpmn:extensionElements>
          <camunda:inputOutput>
            <camunda:inputParameter name="outputVarName">payment</camunda:inputParameter>
            <camunda:inputParameter name="parameters">
              <camunda:map>
                <camunda:entry key="sourceId">${sourceId}</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
            <camunda:inputParameter name="selectQuery">SELECT p FROM Payment p WHERE p.exId = :sourceId</camunda:inputParameter>
          </camunda:inputOutput>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1umk5kd</bpmn:incoming>
        <bpmn:outgoing>Flow_0gp57gw</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:sequenceFlow id="Flow_0gp57gw" sourceRef="Activity_1rg2fzk" targetRef="Activity_cleanAll" />
      <bpmn:subProcess id="Activity_cleanAll" name="Clean">
        <bpmn:incoming>Flow_0gp57gw</bpmn:incoming>
        <bpmn:outgoing>Flow_03qfneh</bpmn:outgoing>
        <bpmn:startEvent id="Event_0ffxfb4">
          <bpmn:outgoing>Flow_06pmp1b</bpmn:outgoing>
        </bpmn:startEvent>
        <bpmn:serviceTask id="Activity_1rwxkb9" name="Clean PaymentNameList" camunda:delegateExpression="${saveQueryDelegate}">
          <bpmn:extensionElements>
            <camunda:inputOutput>
              <camunda:inputParameter name="parameters">
                <camunda:map>
                  <camunda:entry key="payment">${payment}</camunda:entry>
                </camunda:map>
              </camunda:inputParameter>
              <camunda:inputParameter name="saveQuery">delete from PaymentNameList pp where pp.paymentParticipantListId in  (select p from PaymentParticipantList p where p.paymentId= :payment)</camunda:inputParameter>
            </camunda:inputOutput>
          </bpmn:extensionElements>
          <bpmn:incoming>Flow_06pmp1b</bpmn:incoming>
          <bpmn:outgoing>Flow_0tb6fun</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_06pmp1b" sourceRef="Event_0ffxfb4" targetRef="Activity_1rwxkb9" />
        <bpmn:sequenceFlow id="Flow_0tb6fun" sourceRef="Activity_1rwxkb9" targetRef="Activity_1d3ubp9" />
        <bpmn:endEvent id="Event_0i2s4i2">
          <bpmn:incoming>Flow_1kwi2jy</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:serviceTask id="Activity_1d3ubp9" name="Clean PaymentAddressList" camunda:delegateExpression="${saveQueryDelegate}">
          <bpmn:extensionElements>
            <camunda:inputOutput>
              <camunda:inputParameter name="parameters">
                <camunda:map>
                  <camunda:entry key="payment">${payment}</camunda:entry>
                </camunda:map>
              </camunda:inputParameter>
              <camunda:inputParameter name="saveQuery">delete from PaymentAddressList pp where pp.paymentParticipantListId in  (select p from PaymentParticipantList p where p.paymentId= :payment)</camunda:inputParameter>
            </camunda:inputOutput>
          </bpmn:extensionElements>
          <bpmn:incoming>Flow_0tb6fun</bpmn:incoming>
          <bpmn:outgoing>Flow_11gjyxd</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_11gjyxd" sourceRef="Activity_1d3ubp9" targetRef="Activity_1mo5koj" />
        <bpmn:serviceTask id="Activity_1mo5koj" name="Clean PaymentDateDetails " camunda:delegateExpression="${saveQueryDelegate}">
          <bpmn:extensionElements>
            <camunda:inputOutput>
              <camunda:inputParameter name="parameters">
                <camunda:map>
                  <camunda:entry key="payment">${payment}</camunda:entry>
                </camunda:map>
              </camunda:inputParameter>
              <camunda:inputParameter name="saveQuery">delete from PaymentDateDetails pp where pp.paymentParticipantListId in  (select p from PaymentParticipantList p where p.paymentId= :payment)</camunda:inputParameter>
            </camunda:inputOutput>
          </bpmn:extensionElements>
          <bpmn:incoming>Flow_11gjyxd</bpmn:incoming>
          <bpmn:outgoing>Flow_0hxzwcc</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_0hxzwcc" sourceRef="Activity_1mo5koj" targetRef="Activity_1wde41o" />
        <bpmn:serviceTask id="Activity_1wde41o" name="Clean PaymentIdentityAdrList" camunda:delegateExpression="${saveQueryDelegate}">
          <bpmn:extensionElements>
            <camunda:inputOutput>
              <camunda:inputParameter name="parameters">
                <camunda:map>
                  <camunda:entry key="payment">${payment}</camunda:entry>
                </camunda:map>
              </camunda:inputParameter>
              <camunda:inputParameter name="saveQuery">delete from PaymentIdentityAdrList pp where pp.paymentParticipantListId in  (select p from PaymentParticipantList p where p.paymentId= :payment)</camunda:inputParameter>
            </camunda:inputOutput>
          </bpmn:extensionElements>
          <bpmn:incoming>Flow_0hxzwcc</bpmn:incoming>
          <bpmn:outgoing>Flow_15kzfjs</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_15kzfjs" sourceRef="Activity_1wde41o" targetRef="Activity_0p3l7hy" />
        <bpmn:serviceTask id="Activity_0p3l7hy" name="Clean PaymentVersionsList" camunda:delegateExpression="${saveQueryDelegate}">
          <bpmn:extensionElements>
            <camunda:inputOutput>
              <camunda:inputParameter name="parameters">
                <camunda:map>
                  <camunda:entry key="payment">${payment}</camunda:entry>
                </camunda:map>
              </camunda:inputParameter>
              <camunda:inputParameter name="saveQuery">delete from PaymentVersionsList pp where pp.paymentParticipantListId in  (select p from PaymentParticipantList p where p.paymentId= :payment)</camunda:inputParameter>
            </camunda:inputOutput>
          </bpmn:extensionElements>
          <bpmn:incoming>Flow_15kzfjs</bpmn:incoming>
          <bpmn:outgoing>Flow_0jk4pfq</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_0jk4pfq" sourceRef="Activity_0p3l7hy" targetRef="Activity_1re54o8" />
        <bpmn:serviceTask id="Activity_1re54o8" name="Clean PaymentParticipantList" camunda:delegateExpression="${saveQueryDelegate}">
          <bpmn:extensionElements>
            <camunda:inputOutput>
              <camunda:inputParameter name="parameters">
                <camunda:map>
                  <camunda:entry key="payment">${payment}</camunda:entry>
                </camunda:map>
              </camunda:inputParameter>
              <camunda:inputParameter name="saveQuery">delete from PaymentParticipantList p where p.paymentId = :payment</camunda:inputParameter>
            </camunda:inputOutput>
          </bpmn:extensionElements>
          <bpmn:incoming>Flow_0jk4pfq</bpmn:incoming>
          <bpmn:outgoing>Flow_1kwi2jy</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_1kwi2jy" sourceRef="Activity_1re54o8" targetRef="Event_0i2s4i2" />
      </bpmn:subProcess>
      <bpmn:sequenceFlow id="Flow_03qfneh" sourceRef="Activity_cleanAll" targetRef="Activity_0ihdmsv" />
      <bpmn:serviceTask id="Activity_0ihdmsv" name="StartTransactionDelegate" camunda:delegateExpression="${startTransactionDelegate}">
        <bpmn:incoming>Flow_03qfneh</bpmn:incoming>
        <bpmn:outgoing>Flow_0iv08qe</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:sequenceFlow id="Flow_0iv08qe" sourceRef="Activity_0ihdmsv" targetRef="Activity_0r6pu6m" />
      <bpmn:serviceTask id="Activity_0niwx3m" name="EndTransactionDelegate" camunda:delegateExpression="${endTransactionDelegate}">
        <bpmn:incoming>Flow_14oy0al</bpmn:incoming>
        <bpmn:outgoing>Flow_0ckeiru</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:sequenceFlow id="Flow_0ckeiru" sourceRef="Activity_0niwx3m" targetRef="Event_0knzkdy" />
    </bpmn:subProcess>
    <bpmn:sequenceFlow id="Flow_1fmjt5z" sourceRef="Activity_1qwn6qf" targetRef="Activity_038bidn" />
    <bpmn:sequenceFlow id="Flow_16i4xfs" sourceRef="Activity_038bidn" targetRef="Activity_131dz13" />
    <bpmn:sequenceFlow id="Flow_0tmz7xl" sourceRef="Activity_1jae6rb" targetRef="Activity_1qwn6qf" />
      <bpmn:serviceTask id="Activity_131dz13" name="Закрыть сессию"
                        camunda:delegateExpression="${CloseSessionRnkbDelegate}">
          <bpmn:incoming>Flow_16i4xfs</bpmn:incoming>
          <bpmn:outgoing>Flow_1qkyy98</bpmn:outgoing>
      </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1qkyy98" sourceRef="Activity_131dz13" targetRef="Event_009dr5b" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="amlCsmKycPaymentRequest">
      <bpmndi:BPMNEdge id="Flow_1qkyy98_di" bpmnElement="Flow_1qkyy98">
        <di:waypoint x="5490" y="310" />
        <di:waypoint x="5542" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0tmz7xl_di" bpmnElement="Flow_0tmz7xl">
        <di:waypoint x="330" y="320" />
        <di:waypoint x="380" y="320" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_16i4xfs_di" bpmnElement="Flow_16i4xfs">
        <di:waypoint x="5340" y="310" />
        <di:waypoint x="5390" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1fmjt5z_di" bpmnElement="Flow_1fmjt5z">
        <di:waypoint x="480" y="320" />
        <di:waypoint x="530" y="320" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dvx4sc_di" bpmnElement="Flow_0dvx4sc">
        <di:waypoint x="195" y="320" />
        <di:waypoint x="230" y="320" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="159" y="302" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_009dr5b_di" bpmnElement="Event_009dr5b">
        <dc:Bounds x="5542" y="292" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1jae6rb_di" bpmnElement="Activity_1jae6rb">
        <dc:Bounds x="230" y="280" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1qwn6qf_di" bpmnElement="Activity_1qwn6qf">
        <dc:Bounds x="380" y="280" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_038bidn_di" bpmnElement="Activity_038bidn" isExpanded="true">
        <dc:Bounds x="530" y="80" width="4810" height="470" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0ckeiru_di" bpmnElement="Flow_0ckeiru">
        <di:waypoint x="5170" y="308" />
        <di:waypoint x="5262" y="308" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0iv08qe_di" bpmnElement="Flow_0iv08qe">
        <di:waypoint x="2165" y="315" />
        <di:waypoint x="2280" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_03qfneh_di" bpmnElement="Flow_03qfneh">
        <di:waypoint x="1985" y="315" />
        <di:waypoint x="2065" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0gp57gw_di" bpmnElement="Flow_0gp57gw">
        <di:waypoint x="880" y="315" />
        <di:waypoint x="930" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_14oy0al_di" bpmnElement="Flow_14oy0al">
        <di:waypoint x="4970" y="308" />
        <di:waypoint x="5070" y="308" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1umk5kd_di" bpmnElement="Flow_1umk5kd">
        <di:waypoint x="750" y="315" />
        <di:waypoint x="780" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1jftf2k_di" bpmnElement="Flow_1jftf2k">
        <di:waypoint x="626" y="315" />
        <di:waypoint x="650" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_1i5ua25_di" bpmnElement="Event_1i5ua25">
        <dc:Bounds x="590" y="297" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0r6pu6m_di" bpmnElement="Activity_0r6pu6m" isExpanded="true">
        <dc:Bounds x="2280" y="130" width="2690" height="370" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0mdt0l2_di" bpmnElement="Flow_0mdt0l2">
        <di:waypoint x="2550" y="335" />
        <di:waypoint x="2550" y="410" />
        <di:waypoint x="2800" y="410" />
        <di:waypoint x="2800" y="350" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0bpnrqx_di" bpmnElement="Flow_0bpnrqx">
        <di:waypoint x="2575" y="310" />
        <di:waypoint x="2620" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0282xbk_di" bpmnElement="Flow_0282xbk">
        <di:waypoint x="2470" y="310" />
        <di:waypoint x="2525" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hol4z5_di" bpmnElement="Flow_1hol4z5">
        <di:waypoint x="4820" y="310" />
        <di:waypoint x="4872" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_13273lk_di" bpmnElement="Flow_13273lk">
        <di:waypoint x="3530" y="305" />
        <di:waypoint x="3580" y="305" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_15ozxgg_di" bpmnElement="Flow_15ozxgg">
        <di:waypoint x="2850" y="310" />
        <di:waypoint x="2890" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1wz3krn_di" bpmnElement="Flow_1wz3krn">
        <di:waypoint x="2720" y="310" />
        <di:waypoint x="2750" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ta22l9_di" bpmnElement="Flow_0ta22l9">
        <di:waypoint x="2338" y="310" />
        <di:waypoint x="2370" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_0zr8io9_di" bpmnElement="Event_0zr8io9">
        <dc:Bounds x="2302" y="292" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0b3n9ai_di" bpmnElement="Activity_0b3n9ai">
        <dc:Bounds x="2620" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0tkm8x5_di" bpmnElement="Activity_0tkm8x5">
        <dc:Bounds x="2750" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1gl8w9m_di" bpmnElement="Activity_1gl8w9m" isExpanded="true">
        <dc:Bounds x="3580" y="170" width="1240" height="280" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0amh954_di" bpmnElement="Flow_0amh954">
        <di:waypoint x="4620" y="310" />
        <di:waypoint x="4680" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hx378b_di" bpmnElement="Flow_0hx378b">
        <di:waypoint x="4480" y="310" />
        <di:waypoint x="4520" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_120dadj_di" bpmnElement="Flow_120dadj">
        <di:waypoint x="4330" y="310" />
        <di:waypoint x="4380" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0rkt63w_di" bpmnElement="Flow_0rkt63w">
        <di:waypoint x="4190" y="310" />
        <di:waypoint x="4230" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1kzf160_di" bpmnElement="Flow_1kzf160">
        <di:waypoint x="4050" y="310" />
        <di:waypoint x="4090" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0s3o05k_di" bpmnElement="Flow_0s3o05k">
        <di:waypoint x="3920" y="310" />
        <di:waypoint x="3950" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_18p96ei_di" bpmnElement="Flow_18p96ei">
        <di:waypoint x="3648" y="310" />
        <di:waypoint x="3690" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0xdcwid_di" bpmnElement="Flow_0xdcwid">
        <di:waypoint x="3790" y="310" />
        <di:waypoint x="3820" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_0nv9ff9_di" bpmnElement="Event_0nv9ff9">
        <dc:Bounds x="3612" y="292" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0m9twxx_di" bpmnElement="Activity_0m9twxx">
        <dc:Bounds x="3690" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1y9vtta_di" bpmnElement="Activity_1y9vtta">
        <dc:Bounds x="3950" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1wycmbs_di" bpmnElement="Activity_1wycmbs">
        <dc:Bounds x="4090" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0o0n8xl_di" bpmnElement="Activity_0o0n8xl">
        <dc:Bounds x="4230" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_07x6zp6_di" bpmnElement="Activity_07x6zp6">
        <dc:Bounds x="4380" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0u8r0f3_di" bpmnElement="Activity_0u8r0f3">
        <dc:Bounds x="4520" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_12abc37_di" bpmnElement="Activity_saveResultPaymentDetails">
        <dc:Bounds x="4680" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1b3ccxt_di" bpmnElement="Activity_saveResultPayment">
        <dc:Bounds x="3820" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ssloc2_di" bpmnElement="Activity_0ssloc2" isExpanded="true">
        <dc:Bounds x="2890" y="180" width="640" height="270" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0xvvzc9_di" bpmnElement="Flow_0xvvzc9">
        <di:waypoint x="3200" y="335" />
        <di:waypoint x="3200" y="372" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0uwbuwb_di" bpmnElement="Flow_0uwbuwb">
        <di:waypoint x="3225" y="310" />
        <di:waypoint x="3300" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0p7b6p4_di" bpmnElement="Flow_0p7b6p4">
        <di:waypoint x="3400" y="310" />
        <di:waypoint x="3462" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0g5gua9_di" bpmnElement="Flow_0g5gua9">
        <di:waypoint x="3120" y="310" />
        <di:waypoint x="3175" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1bqv0dq_di" bpmnElement="Flow_1bqv0dq">
        <di:waypoint x="2966" y="310" />
        <di:waypoint x="3020" y="310" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_0oscivf_di" bpmnElement="Event_0oscivf">
        <dc:Bounds x="2930" y="292" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1a2ocux_di" bpmnElement="Activity_1a2ocux">
        <dc:Bounds x="3020" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_16fa7sg_di" bpmnElement="Activity_saveKyc">
        <dc:Bounds x="3300" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1xilmdc_di" bpmnElement="Event_1xilmdc">
        <dc:Bounds x="3462" y="292" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0m59lfj_di" bpmnElement="Gateway_0m59lfj" isMarkerVisible="true">
        <dc:Bounds x="3175" y="285" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_10zoaaq_di" bpmnElement="Event_10zoaaq">
        <dc:Bounds x="3182" y="372" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_18yqgty_di" bpmnElement="Event_18yqgty">
        <dc:Bounds x="4872" y="292" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0nb4w2c_di" bpmnElement="Activity_0nb4w2c">
        <dc:Bounds x="2370" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_06l322v_di" bpmnElement="Gateway_06l322v" isMarkerVisible="true">
        <dc:Bounds x="2525" y="285" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0us54of_di" bpmnElement="Activity_payload">
        <dc:Bounds x="650" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0knzkdy_di" bpmnElement="Event_0knzkdy">
        <dc:Bounds x="5262" y="290" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1rg2fzk_di" bpmnElement="Activity_1rg2fzk">
        <dc:Bounds x="780" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1qs1g3k_di" bpmnElement="Activity_cleanAll" isExpanded="true">
        <dc:Bounds x="930" y="215" width="1055" height="200" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1kwi2jy_di" bpmnElement="Flow_1kwi2jy">
        <di:waypoint x="1800" y="315" />
        <di:waypoint x="1917" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0jk4pfq_di" bpmnElement="Flow_0jk4pfq">
        <di:waypoint x="1660" y="315" />
        <di:waypoint x="1700" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_15kzfjs_di" bpmnElement="Flow_15kzfjs">
        <di:waypoint x="1530" y="315" />
        <di:waypoint x="1560" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hxzwcc_di" bpmnElement="Flow_0hxzwcc">
        <di:waypoint x="1400" y="315" />
        <di:waypoint x="1430" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_11gjyxd_di" bpmnElement="Flow_11gjyxd">
        <di:waypoint x="1270" y="315" />
        <di:waypoint x="1300" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0tb6fun_di" bpmnElement="Flow_0tb6fun">
        <di:waypoint x="1140" y="315" />
        <di:waypoint x="1170" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_06pmp1b_di" bpmnElement="Flow_06pmp1b">
        <di:waypoint x="1008" y="315" />
        <di:waypoint x="1040" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_0ffxfb4_di" bpmnElement="Event_0ffxfb4">
        <dc:Bounds x="972" y="297" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ndf1xa_di" bpmnElement="Activity_1rwxkb9">
        <dc:Bounds x="1040" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0i2s4i2_di" bpmnElement="Event_0i2s4i2">
        <dc:Bounds x="1917" y="297" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1d3ubp9_di" bpmnElement="Activity_1d3ubp9">
        <dc:Bounds x="1170" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1mo5koj_di" bpmnElement="Activity_1mo5koj">
        <dc:Bounds x="1300" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1wde41o_di" bpmnElement="Activity_1wde41o">
        <dc:Bounds x="1430" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0p3l7hy_di" bpmnElement="Activity_0p3l7hy">
        <dc:Bounds x="1560" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1re54o8_di" bpmnElement="Activity_1re54o8">
        <dc:Bounds x="1700" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ihdmsv_di" bpmnElement="Activity_0ihdmsv">
        <dc:Bounds x="2065" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0niwx3m_di" bpmnElement="Activity_0niwx3m">
        <dc:Bounds x="5070" y="268" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_131dz13_di" bpmnElement="Activity_131dz13">
        <dc:Bounds x="5390" y="270" width="100" height="80" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
